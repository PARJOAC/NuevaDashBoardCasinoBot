<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Dashboard - CasinoBot</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .server-card img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border: 3px solid #dee2e6;
        transition: transform 0.2s;
      }
      .server-card img:hover {
        transform: scale(1.05);
      }
      .search-bar {
        max-width: 500px;
        margin: 0 auto 30px auto;
      }
      .card {
        border-radius: 15px;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
      }
    </style>
  </head>

  <body class="bg-light">
    <%- include('partials/navbar') %>

    <div class="container mt-5">
      <h2 class="fw-bold mb-4 text-center">Available Servers</h2>

      <!-- 🔍 Search Bar -->
      <div class="search-bar input-group mb-4">
        <span class="input-group-text bg-white border-end-0"> 🔍 </span>
        <input
          type="text"
          id="server-search"
          class="form-control border-start-0"
          placeholder="Search servers..."
        />
      </div>

      <div class="row justify-content-center" id="servers-container">
        <% if (servers && servers.length > 0) { %> <% servers.forEach(server =>
        { %>
        <div class="col-md-4 mb-4 server-card">
          <div class="card shadow-sm text-center p-3 h-100">
            <div class="card-body">
              <img
                src="<%= server.icon ? `https://cdn.discordapp.com/icons/${server.id}/${server.icon}.png` : 'https://cdn.discordapp.com/embed/avatars/0.png' %>"
                class="rounded-circle mb-3"
                alt="Server Icon"
              />

              <h5 class="card-title fw-bold"><%= server.name %></h5>

              <% if (server.owner) { %>
              <span class="badge bg-primary mb-2">👑 Owner</span><br />
              <% } %> <% if (server.premium) { %>
              <span class="badge bg-warning text-dark mb-3"
                >⭐ Premium Active</span
              >
              <% } else { %>
              <span class="badge bg-secondary mb-3">🚫 No Premium</span>
              <% } %> <% if (server.isBotInServer) { %> <% if (server.premium) {
              %>
              <a
                href="/servers/<%= server.id %>/settings"
                class="btn btn-primary w-100 mb-2"
              >
                ⚙ Configure
              </a>
              <% } else { %>
              <a
                href="/servers/<%= server.id %>/buy-premium"
                class="btn btn-warning w-100 mb-2"
              >
                💳 Buy Premium
              </a>
              <% } %> <% } else { %>
              <a
                href="https://discord.com/oauth2/authorize?client_id=<%= clientId %>&scope=bot&permissions=8&guild_id=<%= server.id %>&redirect_uri=<%= encodeURIComponent(`${process.env.BASE_URL}/dashboard`) %>&response_type=code"
                class="btn btn-success w-100 mb-2"
              >
                ➕ Invite Bot
              </a>
              <% } %>
            </div>
          </div>
        </div>
        <% }) %> <% } else { %>
        <p class="text-muted text-center">
          No servers found where you are an administrator.
        </p>
        <% } %>
      </div>
    </div>

    <%- include('partials/footer') %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // 🔍 Filtro de servidores
      document
        .getElementById("server-search")
        .addEventListener("input", function () {
          const searchValue = this.value.toLowerCase();
          document.querySelectorAll(".server-card").forEach((card) => {
            const serverName = card
              .querySelector(".card-title")
              .textContent.toLowerCase();
            card.style.display = serverName.includes(searchValue)
              ? "block"
              : "none";
          });
        });
    </script>
  </body>
</html>
